<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Brocki Buchsuche v1.1</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 750px; margin: 40px auto; padding: 10px; }
    input, button { font-size: 1.1em; padding: 8px; margin-bottom: 10px; width: 100%; }
    #result { margin-top: 20px; border-top:1px solid #ccc; padding-top:15px; }
    .book { margin-bottom: 20px; padding-bottom: 10px; border-bottom:1px solid #ddd; display:flex; }
    .cover { margin-right: 15px; }
    .cover img { width: 120px; }
    .info { flex: 1; }
    a { display: inline-block; margin: 2px 5px 2px 0; color: #0066cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    #version { margin-top: 30px; font-size: 0.9em; color: #666; }
    .eurobuch-form { margin-top: 10px; padding: 10px; border: 1px solid #aaa; background-color: #f0f0f0; width: fit-content; }
  </style>
</head>
<body>

<h1>üìö Brocki Buchsuche</h1>

<input id="searchText" placeholder="ISBN, Titel oder Autor">
<button onclick="searchBook()">Suchen</button>

<div id="result"></div>

<div id="version">Version 1.1</div>

<script>
async function searchBook() {
  const query = document.getElementById("searchText").value.trim();
  const resDiv = document.getElementById("result");

  if (!query) {
    resDiv.innerHTML = "<p>Bitte zuerst etwas eingeben.</p>";
    return;
  }

  resDiv.innerHTML = "<p>üîç Suche l√§uft‚Ä¶</p>";

  try {
    // Open Library Suche
    const resp = await fetch("https://openlibrary.org/search.json?q=" + encodeURIComponent(query));
    const data = await resp.json();

    if (!data.docs || data.docs.length === 0) {
      resDiv.innerHTML = "<p>‚ùå Keine B√ºcher gefunden.</p>";
      return;
    }

    const books = data.docs.slice(0, 5);
    let html = "";

    books.forEach(book => {
      const title = book.title || "‚Äì";
      const author = book.author_name ? book.author_name.join(", ") : "‚Äì";
      const isbn = book.isbn ? book.isbn[0] : "";

      // Coverbild
      const coverUrl = isbn ? `https://covers.openlibrary.org/b/isbn/${isbn}-M.jpg` : "";

      // Fiktiver Neupreis
      const neupreis = 25; // CHF
      const verkaufspreis = (neupreis / 5).toFixed(2);

      // Shoplinks
      const orellLink = `https://www.orellfuessli.ch/shop/home/search?q=${encodeURIComponent(query)}`;
      const exlibrisLink = `https://www.exlibris.ch/de/suche?searchTerm=${encodeURIComponent(query)}`;

      html += `<div class="book">
        <div class="cover">${coverUrl ? `<img src="${coverUrl}" alt="Cover">` : "Kein Cover verf√ºgbar"}</div>
        <div class="info">
          <h2>${title}</h2>
          <p><b>Autor:</b> ${author}</p>
          ${isbn ? `<p><b>ISBN:</b> ${isbn}</p>` : "<p>‚ö†Ô∏è Keine ISBN gefunden.</p>"}
          <p>üí∞ Preisvorschlag: <b>${verkaufspreis} CHF</b> (1/5 vom Neupreis)</p>
          <p>
            <a href="https://www.melando.ch/de/books?search=${encodeURIComponent(query)}" target="_blank">Melando</a>
            <a href="https://www.medimops.de/search?query=${encodeURIComponent(query)}" target="_blank">Medimops</a>
            <a href="https://www.zvab.com/search?q=${encodeURIComponent(query)}" target="_blank">ZVAB</a>
            <a href="https://www.buchplanet.ch/?s=${encodeURIComponent(query)}" target="_blank">Buchplanet</a>
          </p>
          <p>
            <a href="${orellLink}" target="_blank">Orell F√ºssli</a>
            <a href="${exlibrisLink}" target="_blank">Ex Libris</a>
          </p>
        </div>
      </div>`;

      // Eurobuch Formular dynamisch erzeugen
      const euroForm = document.createElement("form");
      euroForm.method = "post";
      euroForm.action = "https://www.eurobuch.ch/search_results.php";
      euroForm.target = "_blank";
      euroForm.className = "eurobuch-form";

      // Autor
      const inputAuthor = document.createElement("input");
      inputAuthor.type = "hidden";
      inputAuthor.name = "author";
      inputAuthor.value = author;
      euroForm.appendChild(inputAuthor);

      // Titel
      const inputTitle = document.createElement("input");
      inputTitle.type = "hidden";
      inputTitle.name = "title";
      inputTitle.value = title;
      euroForm.appendChild(inputTitle);

      // Volltext
      const inputSearch = document.createElement("input");
      inputSearch.type = "hidden";
      inputSearch.name = "search";
      inputSearch.value = title;
      euroForm.appendChild(inputSearch);

      // ISBN
      const inputISBN = document.createElement("input");
      inputISBN.type = "hidden";
      inputISBN.name = "isbn";
      inputISBN.value = isbn;
      euroForm.appendChild(inputISBN);

      // Submit Button
      const submitBtn = document.createElement("input");
      submitBtn.type = "submit";
      submitBtn.value = "Auf Eurobuch suchen";
      euroForm.appendChild(submitBtn);

      html += euroForm.outerHTML;
    });

    resDiv.innerHTML = html;

  } catch (err) {
    console.error(err);
    resDiv.innerHTML = "<p>‚ö†Ô∏è Fehler bei der Suche.</p>";
  }
}

// Enter-Taste aktivieren
document.getElementById("searchText").addEventListener("keydown", function(e) {
  if (e.key === "Enter") searchBook();
});
</script>

</body>
</html>
