<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Brocki Buchsuche mit Cover + Shoplinks</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 40px auto; padding: 10px; }
    input, button { font-size: 1.1em; padding: 8px; margin-bottom: 10px; width: 100%; }
    #result { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 15px; }
    .book { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd; display: flex; }
    .cover { margin-right: 15px; }
    .cover img { width: 120px; }
    .info { flex: 1; }
    a { display: inline-block; margin: 2px 5px 2px 0; color: #0066cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>

<h1>üìö Brocki Buchsuche mit Cover & Shoplinks</h1>

<input id="searchText" placeholder="ISBN, Titel oder Autor">
<button onclick="searchBook()">Suchen</button>

<div id="result"></div>

<script>
async function searchBook() {
  const query = document.getElementById("searchText").value.trim();
  const resDiv = document.getElementById("result");

  if (!query) {
    resDiv.innerHTML = "<p>Bitte zuerst etwas eingeben.</p>";
    return;
  }

  resDiv.innerHTML = "<p>üîç Suche l√§uft‚Ä¶</p>";

  try {
    // ===== Open Library Suche =====
    const resp = await fetch("https://openlibrary.org/search.json?q=" + encodeURIComponent(query));
    const data = await resp.json();

    if (!data.docs || data.docs.length === 0) {
      resDiv.innerHTML = "<p>‚ùå Keine B√ºcher gefunden.</p>";
      return;
    }

    // Nur die ersten 5 Ergebnisse
    const books = data.docs.slice(0, 5);
    let html = "";

    books.forEach(book => {
      const title = book.title || "‚Äì";
      const author = book.author_name ? book.author_name.join(", ") : "‚Äì";
      const isbn = book.isbn ? book.isbn[0] : null;

      // Coverbild
      let coverUrl = isbn ? `https://covers.openlibrary.org/b/isbn/${isbn}-M.jpg` : "";

      // Fiktiver Neupreis
      const neupreis = 25; // CHF
      const verkaufspreis = (neupreis / 5).toFixed(2);

      html += `<div class="book">
        <div class="cover">${coverUrl ? `<img src="${coverUrl}" alt="Cover">` : "Kein Cover verf√ºgbar"}</div>
        <div class="info">
          <h2>${title}</h2>
          <p><b>Autor:</b> ${author}</p>
          ${isbn ? `<p><b>ISBN:</b> ${isbn}</p>` : "<p>‚ö†Ô∏è Keine ISBN gefunden.</p>"}
          <p>üí∞ Preisvorschlag: <b>${verkaufspreis} CHF</b> (1/5 vom Neupreis)</p>
          <p>
            <a href="https://www.melando.ch/de/books?search=${encodeURIComponent(query)}" target="_blank">Melando</a>
            <a href="https://www.medimops.de/search?query=${encodeURIComponent(query)}" target="_blank">Medimops</a>
            <a href="https://www.zvab.com/search?q=${encodeURIComponent(query)}" target="_blank">ZVAB</a>
            <a href="https://www.buchplanet.ch/?s=${encodeURIComponent(query)}" target="_blank">Buchplanet</a>
          </p>
        </div>
      </div>`;
    });

    resDiv.innerHTML = html;

  } catch (err) {
    console.error(err);
    resDiv.innerHTML = "<p>‚ö†Ô∏è Fehler bei der Suche.</p>";
  }
}

// ===== Enter-Taste aktivieren =====
document.getElementById("searchText").addEventListener("keydown", function(e) {
  if (e.key === "Enter") searchBook();
});
</script>

</body>
</html>
