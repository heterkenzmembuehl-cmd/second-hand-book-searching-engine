<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Brocki Buchsuche mit API</title>
  <style>
    body { font-family: Arial,sans-serif; max-width: 650px; margin: 40px auto; padding:10px;}
    input, button { font-size:1.1em; padding:8px; margin-bottom:10px; width:100%;}
    #result { margin-top:20px; border-top:1px solid #ccc; padding-top:15px;}
  </style>
</head>
<body>

<h1>üìö Brocki Book API‚ÄëSuche</h1>

<input id="searchText" placeholder="ISBN, Titel oder Autor">
<button onclick="searchBook()">Suchen</button>

<div id="result"></div>

<script>
async function searchBook() {
  const query = document.getElementById("searchText").value.trim();
  const resDiv = document.getElementById("result");

  if (!query) {
    resDiv.innerHTML = "<p>Bitte zuerst etwas eingeben.</p>";
    return;
  }
  resDiv.innerHTML = "<p>üîç Suche l√§uft‚Ä¶</p>";

  try {
    // ======= Schritt 1: Open Library Suche =======
    const openResp = await fetch(
      "https://openlibrary.org/search.json?q=" + encodeURIComponent(query)
    );
    const openData = await openResp.json();

    if (!openData.docs || openData.docs.length === 0) {
      resDiv.innerHTML = "<p>‚ùå Keine Daten gefunden.</p>";
      return;
    }

    const first = openData.docs[0];
    const title = first.title || "‚Äì";
    const author = first.author_name ? first.author_name.join(", ") : "‚Äì";
    const isbn = first.isbn ? first.isbn[0] : null;

    let html = `<h2>${title}</h2><p><b>Autor:</b> ${author}</p>`;

    if (!isbn) {
      html += "<p>‚ö†Ô∏è Keine ISBN gefunden.</p>";
      resDiv.innerHTML = html;
      return;
    }

    html += `<p><b>ISBN:</b> ${isbn}</p>`;

    // ======= Schritt 2: ValoreBooks Preis =======
    const priceResp = await fetch(
      "https://api.valorebooks.com/sellback/pricing/best/" + isbn
    );
    if (!priceResp.ok) {
      html += "<p>‚ö†Ô∏è Kein ValoreBooks‚ÄëPreis verf√ºgbar.</p>";
    } else {
      const priceJson = await priceResp.json();
      const bestPrice = priceJson.price || 0;
      const suggested = (bestPrice / 5).toFixed(2);

      html +=
        `<p>üí∞ Markt‚ÄëPreis (ValoreBooks): <b>${bestPrice} USD</b></p>` +
        `<p>üí° Preisvorschlag (1/5): <b>${suggested} USD</b></p>`;
    }

    resDiv.innerHTML = html;

  } catch (err) {
    console.error(err);
    resDiv.innerHTML = "<p>‚ö†Ô∏è Fehler bei der Suche.</p>";
  }
}
</script>

</body>
</html>
