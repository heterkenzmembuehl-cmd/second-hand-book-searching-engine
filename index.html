<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BücherBrocki</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Header mit Titel und Versionsnummer -->
  <header class="bg-blue-200 shadow p-6 flex flex-col items-center">
    <h1 class="text-4xl font-extrabold text-gray-800 text-center mb-2">BücherBrocki</h1>
    <span id="version" class="text-gray-700 text-sm">Version: 1.1</span>
  </header>

  <main class="max-w-5xl mx-auto p-6">
    <!-- Suchfeld -->
    <div class="mb-6">
      <input
        type="text"
        id="searchInput"
        placeholder="Buch suchen (Titel, Autor, ISBN)..."
        class="w-full p-4 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 text-gray-700 text-lg"
      >
    </div>

    <!-- Anzeige Anzahl Ergebnisse -->
    <div id="resultCount" class="text-gray-700 mb-4 text-lg"></div>

    <!-- Container für Buchkarten -->
    <div id="results" class="grid grid-cols-1 gap-6"></div>
  </main>

  <script>
    const searchInput = document.getElementById('searchInput');
    const resultsDiv = document.getElementById('results');
    const resultCountDiv = document.getElementById('resultCount');

    const appVersion = '1.1'; // Versionsnummer
    document.getElementById('version').textContent = `Version: ${appVersion}`;

    // Mapping-Tabelle für bekannte Verlage
    const publisherLinks = {
      "O'Reilly Media": "https://www.oreilly.com",
      "Springer": "https://www.springer.com",
      "Penguin": "https://www.penguin.com",
      "Pearson": "https://www.pearson.com",
      "Random House": "https://www.randomhouse.com",
      "Rowohlt": "https://www.rowohlt.de",
      "Bertelsmann": "https://www.bertelsmann.de"
    };

    // Pastellfarben für Karten
    const colors = ['bg-pink-100','bg-green-100','bg-yellow-100','bg-blue-100','bg-purple-100','bg-orange-100'];

    // Enter-Taste Suche
    searchInput.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        searchBooks(searchInput.value);
      }
    });

    async function searchBooks(query) {
      if (!query) return;

      resultsDiv.innerHTML = '<p class="text-gray-500 text-lg">Lade Ergebnisse...</p>';
      resultCountDiv.textContent = '';

      try {
        const response = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=10`);
        const data = await response.json();

        if (!data.items || data.items.length === 0) {
          resultsDiv.innerHTML = '<p class="text-red-500 text-lg">Keine Bücher gefunden.</p>';
          resultCountDiv.textContent = '0 Ergebnisse gefunden';
          return;
        }

        const totalResults = data.items.length;
        resultCountDiv.textContent = `${totalResults} Ergebnis${totalResults > 1 ? 'se' : ''} gefunden`;

        resultsDiv.innerHTML = '';
        data.items.forEach(item => {
          const info = item.volumeInfo;
          const sale = item.saleInfo;

          const authors = info.authors ? info.authors.join(', ') : 'Unbekannt';
          const publisher = info.publisher || 'Unbekannt';
          const publishedDate = info.publishedDate || 'Unbekannt';
          const isbn = (info.industryIdentifiers && info.industryIdentifiers.find(id => id.type === 'ISBN_13')) 
                        ? info.industryIdentifiers.find(id => id.type === 'ISBN_13').identifier 
                        : 'Nicht verfügbar';

          // Preis und Link
          let price = 'Nicht verfügbar';
          let priceLink = '';
          let priceColor = 'text-gray-600';
          if (sale.saleability === 'FOR_SALE' && sale.listPrice) {
            price = `${sale.listPrice.amount} ${sale.listPrice.currencyCode}`;
            priceColor = 'text-green-600 font-semibold';
            if (sale.buyLink) priceLink = sale.buyLink;
          }

          // Buchformat
          let bookType = info.printType || 'Unbekannt';
          if (sale.isEbook) bookType = 'eBook';
          // Zusätzliche Formate aus Google Books (falls verfügbar)
          if (sale.saleability === 'FOR_SALE' && sale.listPrice && sale.isEbook) bookType = 'eBook';
          if (info.printType) bookType = info.printType;

          const thumbnail = info.imageLinks ? info.imageLinks.thumbnail : 'https://via.placeholder.com/128x200?text=Kein+Bild';
          const publisherLink = publisherLinks[publisher] || null;
          const bgColor = colors[Math.floor(Math.random() * colors.length)];

          const bookCard = document.createElement('div');
          bookCard.className = `${bgColor} p-5 rounded-2xl shadow-lg hover:shadow-2xl transition flex gap-6`;
          bookCard.innerHTML = `
            <img src="${thumbnail}" alt="Buchcover" class="w-32 h-auto object-cover rounded-lg shadow-md">
            <div>
              <h2 class="text-2xl font-bold text-gray-800 mb-2">${info.title}</h2>
              <p class="text-gray-700"><span class="font-semibold">Autor:</span> ${authors}</p>
              <p class="text-gray-700"><span class="font-semibold">Verlag:</span> ${publisherLink ? `<a href="${publisherLink}" target="_blank" class="text-blue-600 hover:underline">${publisher}</a>` : publisher}</p>
              <p class="text-gray-700"><span class="font-semibold">Erscheinungsjahr:</span> ${publishedDate}</p>
              <p class="text-gray-700"><span class="font-semibold">ISBN:</span> ${isbn}</p>
              <p class="text-gray-700"><span class="font-semibold">Format:</span> ${bookType}</p>
              <p class="${priceColor}"><span class="font-semibold">Preis:</span> ${priceLink ? `<a href="${priceLink}" target="_blank" class="hover:underline">${price}</a>` : price}</p>
            </div>
          `;
          resultsDiv.appendChild(bookCard);
        });

      } catch (error) {
        resultsDiv.innerHTML = '<p class="text-red-500 text-lg">Fehler beim Laden der Bücher.</p>';
        resultCountDiv.textContent = '';
        console.error(error);
      }
    }
  </script>
</body>
</html>
