<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BücherBrocki</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans">
  <header class="bg-white shadow p-4">
    <h1 class="text-2xl font-bold text-gray-800 text-center">BücherBrocki</h1>
  </header>

  <main class="max-w-4xl mx-auto p-6">
    <div class="mb-6">
      <input
        type="text"
        id="searchInput"
        placeholder="Buch suchen (Titel, Autor, ISBN)..."
        class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
      >
    </div>

    <div id="results" class="grid grid-cols-1 gap-4"></div>
  </main>

  <script>
    const searchInput = document.getElementById('searchInput');
    const resultsDiv = document.getElementById('results');

    // Mapping-Tabelle für bekannte Verlage
    const publisherLinks = {
      "O'Reilly Media": "https://www.oreilly.com",
      "Springer": "https://www.springer.com",
      "Penguin": "https://www.penguin.com",
      "Pearson": "https://www.pearson.com",
      "Random House": "https://www.randomhouse.com",
      "Rowohlt": "https://www.rowohlt.de",
      "Bertelsmann": "https://www.bertelsmann.de"
    };

    searchInput.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        searchBooks(searchInput.value);
      }
    });

    async function searchBooks(query) {
      if (!query) return;

      resultsDiv.innerHTML = '<p class="text-gray-500">Lade Ergebnisse...</p>';

      try {
        const response = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=10`);
        const data = await response.json();

        if (!data.items) {
          resultsDiv.innerHTML = '<p class="text-red-500">Keine Bücher gefunden.</p>';
          return;
        }

        resultsDiv.innerHTML = '';
        data.items.forEach(item => {
          const info = item.volumeInfo;
          const sale = item.saleInfo;

          const authors = info.authors ? info.authors.join(', ') : 'Unbekannt';
          const publisher = info.publisher || 'Unbekannt';
          const publishedDate = info.publishedDate || 'Unbekannt';
          const isbn = (info.industryIdentifiers && info.industryIdentifiers.find(id => id.type === 'ISBN_13')) 
                        ? info.industryIdentifiers.find(id => id.type === 'ISBN_13').identifier 
                        : 'Nicht verfügbar';
          const price = sale.saleability === 'FOR_SALE' && sale.listPrice 
                        ? `${sale.listPrice.amount} ${sale.listPrice.currencyCode}` 
                        : 'Nicht verfügbar';

          const publisherLink = publisherLinks[publisher] || null;

          const bookCard = document.createElement('div');
          bookCard.className = 'bg-white p-4 rounded-lg shadow hover:shadow-md transition';
          bookCard.innerHTML = `
            <h2 class="text-xl font-semibold text-gray-800">${info.title}</h2>
            <p class="text-gray-600">Autor: ${authors}</p>
            <p class="text-gray-600">
              Verlag: ${publisherLink ? `<a href="${publisherLink}" target="_blank" class="text-blue-500 hover:underline">${publisher}</a>` : publisher}
            </p>
            <p class="text-gray-600">Erscheinungsjahr: ${publishedDate}</p>
            <p class="text-gray-600">ISBN: ${isbn}</p>
            <p class="text-gray-600">Preis: ${price}</p>
          `;
          resultsDiv.appendChild(bookCard);
        });

      } catch (error) {
        resultsDiv.innerHTML = '<p class="text-red-500">Fehler beim Laden der Bücher.</p>';
        console.error(error);
      }
    }
  </script>
</body>
</html>
